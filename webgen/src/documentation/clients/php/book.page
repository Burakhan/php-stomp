---
title: PHP Stomp Client User Guide
--- name:head pipeline:tags
<link href="{relocatable: /styles/book.css}" rel="stylesheet" type="text/css" />

--- name:content pipeline:tags,asciidoc

{title:}
===========================
Hiram Chirino
v1.0, Dec 2003

Introduction
------------

This project is a PHP Stomp clients that besides it implements the Stomp protocol fully, adds some ActiveMQ specific features that could make your messaging from PHP easier.

Getting Started
---------------

Obtain the source of the library by downloading the distribution and add its content to your `include_path`. Alternatively, you can grab the source and add `src/main` folder to your `include_path`.

Examples are located in `src/examples` folder. Before running them, be sure you have installed this library properly and you have started ActiveMQ broker (recommended version 5.3.0) with Stomp connector enabled (http://activemq.apache.org/stomp.html). 

You can start the first example by running 
	
	cd examples
	php first.php
	
Also, be sure to check comments in the particular examples for some special configuration steps (if needed).

First Example
-------------

The simplest example shows how you can connect to the ActiveMQ message broker and send/receive a message from the queue.

    <?
    // include a library
    require_once("Stomp.php");
    // make a connection
    $con = new Stomp("tcp://localhost:61613");
    // connect
    $con->connect();
    // send a message to the queue
    $con->send("/queue/test", "test");
    echo "Sent message with body 'test'\n";
    // subscribe to the queue
    $con->subscribe("/queue/test");
    // receive a message from the queue
    $msg = $con->readFrame();

    // do what you want with the message
    if ( $msg != null) {
        echo "Received message with body '$msg->body'\n";
        // mark the message as received in the queue
        $con->ack($msg);
    } else {
        echo "Failed to receive a message\n";
    }

    // disconnect
    $con->disconnect();
    ?>

After the execution this script should print

    $ php first.php 
    Sent message with body 'test'
    Received message with body 'test'

and it shows how easy it is to do asynchronous messaging using Stomp.

Transactions
------------

Stomp transactions allow you to send messages and acknowledgments in atomic operations. For more information on transactions, take a look at the following article http://activemq.apache.org/stomp/stomp10/additional.html#transaction_handling.

Now let's go through the basics of transaction usage in PHP Stomp client. To start the transaction, you should use `begin()` method with transaction id as a parameter.

    $stomp->begin("tx1");

In the similar way you can commit or abort your transactions

    $con->commit("tx1");    
    $stomp->abort("tx1");
    
To send a message in a transaction, you should pass an extra `transaction` header, like this
        
    $stomp->send("/queue/transactions", "message text", array("transaction" => "tx1"));

To send an acknowledgment in a transaction, pass transaction id as an extra argument to the `ack()` method, like this    

    $stomp->ack($message, "tx1");

The full example of the transaction usage with PHP Stomp client can be found in `examples/transactions.php`.

Durable Subscribers
-------------------

TODO

Connectivity
------------

TODO

Security
--------

TODO

Handling Errors
---------------

TODO